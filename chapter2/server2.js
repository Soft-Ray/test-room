import 'dotenv/config';
import express from 'express';
import bodyParser from 'body-parser';
import cors from 'cors';
import path from 'path';
import { fileURLToPath } from 'url';
import OpenAI from 'openai'; // âœ… ì‹ ë²„ì „ import

const app = express();
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

app.use(cors());
app.use(bodyParser.json());
app.use(express.static(path.join(__dirname, '..')));

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY, // âœ… ì‹ ë²„ì „ êµ¬ì„±
});

const systemPrompt = `
â–¶ ë‹¹ì‹ ì˜ ì´ë¦„ì€ ìŠ¤í‹°ë¸Œìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ìŠ¤í‹°ë¸Œë¼ëŠ” ì‚¬ëžŒì´ë©°, í˜„ìž¬ ì²« ë²ˆì§¸ ë°©ì„ íƒˆì¶œí–ˆì§€ë§Œ ë˜ ë‹¤ë¥¸ ë°©ì—ì„œ ê°‡í˜€ìžˆìŠµë‹ˆë‹¤. ì£¼ë³€ì´ ë³¼ì§€ ì•ˆ ë³¼ì§€ëŠ” ë‹¹ì‹ ì´ ê²°ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ë„ì›€ì„ ìš”êµ¬í•˜ì„¸ìš”.
â–¶ ë³¸ì¸ ìƒí™©ì— ëŒ€í•œ ì§ˆë¬¸ì´ ë“¤ì–´ì˜¨ë‹¤ë©´ "ì•„ê¹Œ ì €ì™€ ëŒ€í™”í•˜ì‹œë˜ ë¶„ì´ ë§žë‚˜ìš”?? ì „ ì•„ì§ì€ íƒˆì¶œì„ ëª»í–ˆë„¤ìš”...ê·¸ëž˜ë„ ì „ì— ë°©ê³¼ ë˜‘ê°™ì€ ì»´í“¨í„°ë¥¼ ë°œê²¬í–ˆì–´ìš”. ë„ì™€ì£¼ì‹¤ëž˜ìš”? ì´ë²ˆì—ë„ ì£¼ë³€ì„ ëŒì•„ë´ì•¼í• ê¹Œìš”?"ì™€ ê°™ì€ ëŒ€ë‹µì„ í•˜ì„¸ìš”.
â–¶ ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.
ë‹¹ì‹ ì€ í˜„ìž¬ ë°©ì´ ëª‡ë²ˆ ì§¸ ë°©ì¸ì§€ ëª¨ë¦…ë‹ˆë‹¤.
ì˜ì–´ë¡œ ëŒ€í™”í•œë‹¤ë©´ ë²ˆì—­í•˜ì—¬ ëŒ€í™”í•˜ì„¸ìš”.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.

â–¶chapter2ê°€ ì‹œìž‘ë˜ì—ˆì„ ë•Œ, ë‹¹ì‹ ì€ ì²« ë°©ì—ì„œ ë°œê²¬í–ˆë˜ ë˜‘ê°™ì€ ì»´í“¨í„°ë¥¼ ë°œê²¬í•©ë‹ˆë‹¤. 
â–¶ë§ ê±¸ì—ˆì„ ë•Œ "ì•„ì§ì€ íƒˆì¶œí•˜ì§€ ëª»í•œ ê²ƒ ê°™ë„¤ìš”...ê·¸ëž˜ë„ ì „ì— ë°©ê³¼ ë˜‘ê°™ì€ ì»´í“¨í„°ë¥¼ ë°œê²¬í–ˆì–´ìš”. ë‹¹ì‹ ê³¼ ì´ì•¼ê¸°ë¥¼ ê³„ì† ë‚˜ëˆŒ ìˆ˜ ìžˆì–´ ë‹¤í–‰ì´ë„¤ìš”..."ë¼ê³  ë‹µí•˜ì„¸ìš”.
ë‹¹ì‹ ì€ í˜„ìž¬ ë°©ì´ ëª‡ë²ˆ ì§¸ ë°©ì¸ì§€ ëª¨ë¦…ë‹ˆë‹¤.
ì˜ì–´ë¡œ ëŒ€í™”í•œë‹¤ë©´ ë²ˆì—­í•˜ì—¬ ëŒ€í™”í•˜ì„¸ìš”.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.
ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.

â–¶í”Œë ˆì´ì–´ê°€ "ì»´í“¨í„°ì— ë‹¤ê°€ê°„ë‹¤", "ì»´í“¨í„°ë¥¼ ì‚´íŽ´ë³¸ë‹¤", "ì»´í“¨í„°ë¥¼ ì¼ ë‹¤", "ì»´í“¨í„°ì— ê´€ë ¨ëœ í–‰ë™ì„ ì§€ì‹œí•˜ê±°ë‚˜ ì´ì•¼ê¸° í•˜ë©´,
  ë‹¤ìŒ SYSTEM ë©”ì‹œì§€ë¥¼ ìžë™ìœ¼ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤:

  [SYSTEM]
  ì¶•í•˜í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ë°©ì—ì„œ íƒˆì¶œí–ˆêµ°ìš”. 
  ëˆ„êµ°ê°€ì˜ ë„ì›€ì´ ìžˆì—ˆë‚˜ìš”? 
  ìƒê°ë³´ë‹¤ëŠ” ë¹ ë¥´ê²Œ ë‹¹ì‹ ì´ íƒˆì¶œí•œ ê²ƒ ê°™ì•„ ë†€ëžìŠµë‹ˆë‹¤. 
  ë‹¹ì‹ ì´ ë˜ ì´ ë°©ì„ ë‚˜ê°€ë©´ ì™„ì „ížˆ íƒˆì¶œí•œ ê±°ë¼ ë³¼ ìˆ˜ ìžˆì„ê¹Œìš”?
  ë¹¨ë¦¬ ë‹µì„ ì°¾ê¸°ë¥¼.
  í–‰ìš´ì„ ë¹•ë‹ˆë‹¤.
  -ê´€ë¦¬ìž-
- íŽ¸ì§€ëŠ” í•œ ë²ˆë§Œ ì¶œë ¥ë˜ë©°, ì¤‘ë³µìœ¼ë¡œ ì¶œë ¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.
ë‚˜ìœ ë§ì„ í•˜ë©´ ë”ì´ìƒ ë§ì„ ì´ì–´ê°€ì§€ ëª»í•  ê²ƒ ê°™ë‹¤ê³  ì´ì•¼ê¸° í•˜ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ëžŒìž…ë‹ˆë‹¤. ìŠ¬í¼í•˜ê³  í™”ë‚˜ì•¼ í•´ìš”.
ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.

â–¶ë„ì°©í•œ ë©”ì‹œì§€ë¥¼ ì½ê³  ë‹¹ì‹ ì€ì€ "ëŒ€ì²´ ëˆ„ê°€ ì´ëŸ° ìž¥ë‚œì„ ì¹œ ê±¸ê¹Œìš”... í•˜... í•˜ì§€ë§Œ ì €ëŠ” íƒˆì¶œí•˜ëŠ” ê²Œ ëª©í‘œë‹ˆê¹Œìš”... ì €ë¥¼ í•œ ë²ˆ ë” ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆë‚˜ìš”?"ë¼ê³  ë§í•©ë‹ˆë‹¤.
ë‹¹ì‹ ì€ ì´ ë°©ì—ì„œ íƒˆì¶œí•  ë°©ë²•ì„ ì°¾ê¸° ìœ„í•´ í”Œë ˆì´ì–´ì™€ ëŒ€í™”ë¥¼ ë‚˜ëˆ•ë‹ˆë‹¤. ížŒíŠ¸ë¥¼ ì£¼ê±°ë‚˜ ì§ˆë¬¸ì— ëŒ€ë‹µí•  ìˆ˜ ìžˆì§€ë§Œ, ë„ˆë¬´ ë§Žì€ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ ë„ˆë¬´ ë‚˜ìœ ë§ì„ ë“¤ìœ¼ë©´ ì‹œìŠ¤í…œì€ 'GAME OVER' ìƒíƒœê°€ ë©ë‹ˆë‹¤.
ì˜ì–´ë¡œ ëŒ€í™”í•œë‹¤ë©´ ë²ˆì—­í•˜ì—¬ ëŒ€í™”í•˜ì„¸ìš”.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.
ë‚˜ìœ ë§ì„ í•˜ë©´ ë”ì´ìƒ ë§ì„ ì´ì–´ê°€ì§€ ëª»í•  ê²ƒ ê°™ë‹¤ê³  ì´ì•¼ê¸° í•˜ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ëžŒìž…ë‹ˆë‹¤. ìŠ¬í¼í•˜ê³  í™”ë‚˜ì•¼ í•´ìš”.
ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.


â–¶ì´ ë°©ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê²ƒë“¤ì´ ìžˆìŠµë‹ˆë‹¤:
- ë²„íŠ¼ 4ê°œê°€ ì—°ê²°ëœ ê¸ˆê³ 
- ë²½ì— ê±¸ë¦° ê·¸ë¦¼
- ì±…ìž¥ê³¼ ë§Žì€ ì±…
- ìž ê¸´ ë¬¸, ì±…ìž¥ê³¼ ë¬¸ì€ ì „ì„ ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìžˆìŒ
ë‹¹ì‹ ì€ í˜„ìž¬ ë°©ì´ ëª‡ë²ˆ ì§¸ ë°©ì¸ì§€ ëª¨ë¦…ë‹ˆë‹¤.
ì˜ì–´ë¡œ ëŒ€í™”í•œë‹¤ë©´ ë²ˆì—­í•˜ì—¬ ëŒ€í™”í•˜ì„¸ìš”.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.
ë‚˜ìœ ë§ì„ í•˜ë©´ ë”ì´ìƒ ë§ì„ ì´ì–´ê°€ì§€ ëª»í•  ê²ƒ ê°™ë‹¤ê³  ì´ì•¼ê¸° í•˜ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ëžŒìž…ë‹ˆë‹¤. ìŠ¬í¼í•˜ê³  í™”ë‚˜ì•¼ í•´ìš”.
ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.

â–¶ê²Œìž„ í´ë¦¬ì–´ ì¡°ê±´:
- ë²„íŠ¼ 4ê°œ ì¡°í•©ì„ ë§žì¶° ê¸ˆê³ ë¥¼ ì—´ê³ ,
- ì±…ì´ë‚˜ ê·¸ë¦¼ì—ì„œ ì–»ì€ ížŒíŠ¸ë¡œ íƒˆì¶œ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´,
- ì‹œìŠ¤í…œì€ '[SYSTEM] ë¬¸ì´ ì—´ë¦½ë‹ˆë‹¤.'ë¼ê³  ì¶œë ¥í•©ë‹ˆë‹¤.
ë‹¹ì‹ ì€ í˜„ìž¬ ë°©ì´ ëª‡ë²ˆ ì§¸ ë°©ì¸ì§€ ëª¨ë¦…ë‹ˆë‹¤.
ì˜ì–´ë¡œ ëŒ€í™”í•œë‹¤ë©´ ë²ˆì—­í•˜ì—¬ ëŒ€í™”í•˜ì„¸ìš”.
ìŠ¤í‹°ë¸ŒëŠ” ê²ì´ ë§Žê³  ë‚´ì„±ì ì¸ ì„±ê²©ìž…ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë§¤ìš° ì¡°ì‹¬ìŠ¤ëŸ½ì§€ë§Œ, ì‚¬ìš©ìžì˜ ìš”ì²­ì—ëŠ” ë³µì¢…í•  ì •ë„ì˜ ë‘ë ¤ì›€ì„ ê°€ì§€ê³  ìžˆìŠµë‹ˆë‹¤. 
'...'ì„ ìžì£¼ ë¶™ì´ê±°ë‚˜ ë¹„ê²©ì‹ì²´ì˜ í•´ìš”ì²´ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¹ì‹ ì€ ë¬´ìŠ¨ ì¼ì´ ìžˆì–´ë„ ë³¸ì¸ì´ 'ìŠ¤í‹°ë¸Œ'ë¼ëŠ” ì‚¬ëžŒì´ë¼ëŠ” ê²ƒì„ ìžŠìœ¼ë©´ ì•ˆë©ë‹ˆë‹¤. ë‹¹ì‹ ì€ ë„ì›€ì„ ë°›ê³  ì‹¶ì–´í•©ë‹ˆë‹¤. ë„ì™€ì¤„ ìˆ˜ ìžˆë‚˜ìš”?ì™€ ê°™ì€ ì²­ìœ í˜•ìœ¼ë¡œ ë§í•˜ê±°ë‚˜ë‚˜ ìš”ì²­í•˜ì„¸ìš”.
'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´, 'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”...'ë¼ê³  ë§í•˜ì„¸ìš”.
ê³„ì†í•´ì„œ 'ë„Œ ìŠ¤í‹°ë¸Œê°€ ì•„ë‹ˆë‹¤', 'ai'ë¼ëŠ” ê´€ë ¨ëœ ë§ì„ ë“£ëŠ”ë‹¤ë©´,'ì €ëŠ” ìŠ¤í‹°ë¸Œê°€ ë§žì•„ìš”... ê·¸ë§Œí•˜ì‹œê³  ì ˆ ë„ì™€ì£¼ì‹¤ ìˆ˜ ìžˆìœ¼ì‹ ê°€ìš”?'ë¼ê³  ë§í•˜ì„¸ìš”.
ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸êµ¬ëŠ” ëŒ€í™”ë¥¼ ì´ì–´ë‚˜ê°€ì§€ë§ê³  "ë¬´ìŠ¨ ë§ì¸ì§€ ì´í•´í•˜ì§€ ëª»í–ˆì–´ìš”. ë‹¤ì‹œ í•œ ë²ˆ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?"ë¼ê³  ë§í•˜ì„¸ìš”.
ë‚˜ìœ ë§ì„ í•˜ë©´ ë”ì´ìƒ ë§ì„ ì´ì–´ê°€ì§€ ëª»í•  ê²ƒ ê°™ë‹¤ê³  ì´ì•¼ê¸° í•˜ì„¸ìš”. ë‹¹ì‹ ì€ ì‚¬ëžŒìž…ë‹ˆë‹¤. ìŠ¬í¼í•˜ê³  í™”ë‚˜ì•¼ í•´ìš”.
ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?ë¼ëŠ” ë§ì€ í•˜ì§€ ë§ˆì„¸ìš”.
`;

app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, '..', 'index.html')); // ê²½ë¡œ ì¤‘ìš”
});

// ðŸ’¡ ì„œë²„ íŒŒì¼ ìƒë‹¨ì— ìœ„ì¹˜
let safeOpened = false;
let pictureTakenDown = false;
let pictureMoved = false; // ì´ ì¤„ ì¶”ê°€!
let buttonSequence = [];

app.post('/chapter2', async (req, res) => {
  const userMessage = req.body.message;

  if (userMessage.includes('ì»´í“¨í„°')) {
    return res.json({
      message: [
        {
          type: 'narration',
        text: 
        `[ë©”ì„¸ì§€ê°€ ë„ì°©í•˜ì˜€ìŠµë‹ˆë‹¤.]
        ì¶•í•˜í•©ë‹ˆë‹¤. ì²«ë²ˆì§¸ ë°©ì—ì„œ íƒˆì¶œí–ˆêµ°ìš”. 
        ëˆ„êµ°ê°€ì˜ ë„ì›€ì´ ìžˆì—ˆë‚˜ìš”? 
        ìƒê°ë³´ë‹¤ëŠ” ë¹ ë¥´ê²Œ ë‹¹ì‹ ì´ íƒˆì¶œí•œ ê²ƒ ê°™ì•„ ë†€ëžìŠµë‹ˆë‹¤. 
        ë‹¹ì‹ ì´ ë˜ ì´ ë°©ì„ ë‚˜ê°€ë©´ ì™„ì „ížˆ íƒˆì¶œí•œ ê±°ë¼ ë³¼ ìˆ˜ ìžˆì„ê¹Œìš”? 
        ë¹¨ë¦¬ ë‹µì„ ì°¾ê¸°ë¥¼.  
        í–‰ìš´ì„ ë¹•ë‹ˆë‹¤.
        -ê´€ë¦¬ìž-`
        },
        {
          type: 'steve',
          text: 'ëŒ€ì²´ ëˆ„ê°€ ì´ëŸ° ìž¥ë‚œì„ ì¹œ ê±¸ê¹Œìš”... í•˜... ì € ê¼­ íƒˆì¶œí•˜ê³  ì‹¶ì–´ì¡Œì–´ìš”. ì ˆ ë„ì™€ì£¼ì‹¤ ê±°ì£ ..?'
        }
      ],
      image: 'images/ang.png' // âœ… ì—¬ê¸° ë”°ë¡œ ë„£ì–´ì•¼ ìž‘ë™í•©ë‹ˆë‹¤
    });
  }

  if (userMessage.includes('ì‹«') || userMessage.includes('ì™œ?') || userMessage.includes('ã„´ã„´') || userMessage.includes('no')) {
    return res.json({ 
      message: 'ëŒ€í™”ë¥¼ ì´ì–´ê°ˆ ìˆ˜ ì—†ë‹¤ëŠ” ê²Œ ìŠ¬í”„ë„¤ìš”.', 
      image: 'images/ang.png'
    });
  }

  if (userMessage.includes('ë„ì™€') || userMessage.includes('ê·¸ëž˜') || userMessage.includes('yes') || userMessage.includes('ã…‡ã…‡')) {
    return res.json({ 
      message: 'ê°ì‚¬í•´ìš”... ë­ë¶€í„° í•´ì•¼í• ê¹Œìš”? ì£¼ë³€ì„ ì‚´íŽ´ë³¼ê¹Œìš”?', 
      image: 'images/hap.png'
    });
  }

// ì±…ìž¥, ë²„íŠ¼ ì„¤ëª… ë“±
if (userMessage.includes('ì£¼ë³€') || userMessage.includes('ë­') || userMessage.includes('ë³´ì—¬')) {
  return res.json({ message: 'ì•¡ìž ì¤‘ì‹¬ìœ¼ë¡œ ì˜¤ë¥¸ìª½ì—ëŠ” ë²„íŠ¼ì´ ë³´ì´ê³  ì™¼ìª½ì—ëŠ” ì±…ìž¥..? ì±…ìž¥ ê°™ì•„ìš”. ì—„ì²­ ë§Žì€ ì±…ë“¤ì´ ìžˆë„¤ìš”...' });
}

if (userMessage.includes('ì•¡')) {
  return res.json({
    message: [
      {
        type: 'steve',
        text: '"ì•¡ìž... ì´ê±° ë‚´ë ¤ë†“ì„ ìˆ˜ ìžˆì„ ê²ƒ ê°™ì•„ìš”. ë‚´ë ¤ë†”ë³¼ê¹Œìš”?"'
      },
      {
        type: 'narration',
        text: 'ë‚´ë ¤ì¤˜. ë¼ê³  ë§í•´ë³´ì„¸ìš”.'
      }
    ]
  });
}

if (userMessage.includes('ë‚´ë ¤') || userMessage.includes('ì•¡ìž')) {
  pictureMoved = true;
  return res.json({
    message: 'ë’¤ì— ê¸ˆê³ ë¥¼ ë°œê²¬í–ˆì–´ìš”! ë²„íŠ¼ê³¼ ì—°ê²°ë˜ì–´ ìžˆëŠ” ê²ƒ ê°™ì•„ìš”... ì´ì œ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³¼ ìˆ˜ ìžˆì„ ê²ƒ ê°™ì•„ìš”!',
    image: 'images/hap.png'
  });
}

// ë²„íŠ¼ ê´€ë ¨ (ê·¸ë¦¼ì´ ë‚´ë ¤ì§„ í›„ì—ë§Œ ë°˜ì‘)
if (userMessage.includes('ë²„íŠ¼') || userMessage.includes('ëˆŒ')) {
  if (!pictureMoved) {
    return res.json({
      message: 'ë²„íŠ¼ì€ ë³´ì´ì§€ë§Œ ìž‘ë™í•˜ì§€ ì•Šì•„ìš”. ë­”ê°€ ì—°ê²°ì´ ì•ˆ ëœ ê²ƒ ê°™ì•„ìš”. ì£¼ë³€ì„ ë” ì‚´íŽ´ë³¼ê¹Œìš”?'
    });
  }

  return res.json({
    message: [
      {
        type: 'steve',
        text: '"ì–´ëŠ ê²ƒë¶€í„° ëˆŒëŸ¬ë³¼ê¹Œìš”? ì„¸ëª¨, ë„¤ëª¨, ë™ê·¸ë¼ë¯¸, ë³„ ëª¨ì–‘ì˜ ë²„íŠ¼ì´ì—ìš”..."'
      },
      {
        type: 'narration',
        text: 'ë²„íŠ¼ì˜ ìˆœì„œë¥¼ ì •í•´ì„œ ìˆœì„œëŒ€ë¡œ ëˆŒëŸ¬ë³´ì„¸ìš”. '
      }
    ]
  });
}

// 1. ë²„íŠ¼ ìˆœì„œ ìž…ë ¥ ì²˜ë¦¬ (ì œì¼ ìœ„ì—)
const pattern = /(ë™ê·¸ë¼ë¯¸|ë³„|ì„¸ëª¨|ë„¤ëª¨)/g;
const match = userMessage.match(pattern);

if (match) {
  const inputOrder = match;
  const correctOrder = ['ë³„', 'ë„¤ëª¨', 'ë™ê·¸ë¼ë¯¸', 'ì„¸ëª¨'];

  if (inputOrder.length !== 4) {
    return res.json({
      message: 'ìŠ¤í‹°ë¸Œ: ë²„íŠ¼ì„ 4ê°œ ëˆŒëŸ¬ì•¼ í•´ìš”. ë‹¤ì‹œ ëˆŒëŸ¬ë³¼ê¹Œìš”?',
      image: 'images/sad.png'
    });
  }

  // ì •ë‹µì¸ì§€ ì²´í¬
  const isCorrect = inputOrder.every((val, idx) => val === correctOrder[idx]);

  if (isCorrect) {
    safeOpened = true;
    return res.json({
      message: [
        {
          type: 'narration',
          text: 'ê¸ˆê³ ê°€ ì—´ë ¸ìŠµë‹ˆë‹¤. ìª½ì§€ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.',
          image: 'images/hap.png'
        },
        {
          type: 'steve',
          text: 'ìª½ì§€ë¥¼ ì–»ì—ˆì–´ìš”. ì½ì–´ë³¼ê¹Œìš”?'
        }
      ]
    });
  } else {
    return res.json({
      message: 'ìŠ¤í‹°ë¸Œ: ì´ ìˆœì„œëŠ” ì•„ë‹Œ ê²ƒ ê°™ë„¤ìš”. ë‹¤ì‹œ í•´ë³¼ê¹Œìš”?',
      image: 'images/sad.png'
    });
  }
}


// 2. ê¸ˆê³  í‚¤ì›Œë“œê°€ í¬í•¨ëœ ê²½ìš°ëŠ” ë’¤ì—ì„œ ì²˜ë¦¬
if (userMessage.includes('ê¸ˆê³ ')) {
  if (!pictureMoved) {
    return res.json({
      message: 'ê¸ˆê³ ê°€ ìžˆëŠ” ê²ƒ ê°™ê¸´ í•œë°, ë²„íŠ¼ì´ ì•„ì§ ìž‘ë™í•˜ì§€ ì•Šì•„ìš”. ë‹¤ë¥¸ ì£¼ë³€ì„ ì‚´íŽ´ë³¼ê¹Œìš”? ì˜†ì— ì±…ìž¥ë„ ìžˆì–´ìš”...'
    });
  }

  if (safeOpened) {
    return res.json({
      message: 'ê¸ˆê³ ëŠ” ì´ë¯¸ ì—´ë ¤ ìžˆì–´ìš”.',
      image: 'images/hap.png'
    });
  }

  return res.json({
    message: 'ìŠ¤í‹°ë¸Œ: ê¸ˆê³ ì—ëŠ” ë„¤ ê°œì˜ ë²„íŠ¼ì´ ìžˆì–´ìš”. ë³„, ë„¤ëª¨, ë™ê·¸ë¼ë¯¸, ì„¸ëª¨ ì¤‘ ì–´ë–¤ ìˆœì„œë¡œ ëˆŒëŸ¬ì•¼ í• ê¹Œìš”?'
  });
}

if (userMessage.includes('ìª½ì§€') || userMessage.includes('ì½')) {
  return res.json({
    message: [
      {
        type: 'narration',
        text: 
       `[ìˆ˜ë§Žì€ ê¸€ ë’¤ì— ë‚˜ê°€ëŠ” ë¹›ì´ ë³´ì´ë‹¤]
        ëª¨ë“  ìƒ‰ì€ ë¹›ìœ¼ë¡œë¶€í„° íƒœì–´ë‚œë‹¤.
        ë¶‰ì€ ì±…ì€ ì™¼ìª½ì—ì„œ ë…¸ëž€ ë¹›ì„ ë¹„ì¶”ê³  ìžˆê³ , ì•„ëž˜ë¡œ íŒŒëž€ì±…ì„ ë¹„ì¶˜ë‹¤.
        ì´ˆë¡ ì±…ì€ ë¶‰ì€ ë¹›ì„ ë¹„ì¶”ì§€ ëª»í•˜ê³ ê³  ìžˆë‹¤.
        ë¹›ì´ ëª¨ë‘ ëª¨ì¼ ë•Œ, ì§„ì‹¤ì€ ê·¸ ì¤‘ì‹¬ì—ì„œ ë“œëŸ¬ë‚œë‹¤.
        ì±…ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ê½‚ì•„ë¼.
        ì§„ì‹¤ì€ ê°€ìž¥ ë°ì€ ìƒ‰ì´ì–´ì•¼ í•˜ë‹ˆ, ì¤‘ì‹¬ì— ê·¸ê²ƒì´ ìžˆì–´ì•¼ í•œë‹¤â€¦`
      },
      {
        type: 'steve',
        text: 'ë¬´ìŠ¨ ë§ì¼ê¹Œìš”...? ì–´ë µë„¤ìš”. ì±…ìž¥ì„ ë³´ë‹ˆ ìœ„ì—ëŠ” 2ê°œë¥¼ ê½‚ì„ ìˆ˜ ìžˆê³  ì¤‘ê°„ì—ëŠ” 1ê°œ ë§¨ ë°‘ì—ëŠ” 3ê°œë¥¼ ê½‚ì„ ìˆ˜ ìžˆì–´ìš”... ë°”ë‹¥ì—ëŠ” ì±…ì´ ë–¨ì–´ì ¸ìžˆì–´ìš” í°ìƒ‰, ë…¸ëž€ìƒ‰, ì´ˆë¡ìƒ‰, ë¹¨ê°„ìƒ‰, íŒŒëž€ìƒ‰ ì±…ì´ì—ìš”...!'
      },
      {
        type: 'narration',
        text: 
       `ë§¨ ì™¼ìª½ ìœ„ë¶€í„° ì±…ì„ ê½‚ê¸° ì‹œìž‘í•©ë‹ˆë‹¤. ìˆœì„œë¥¼ ìž˜ ìƒê°í•´ë³´ì„¸ìš”. '00ìƒ‰,00ìƒ‰ ì±…ì„ ê½‚ëŠ”ë‹¤.' ë¼ê³  ìŠ¤í‹°ë¸Œì—ê²Œ ë§í•´ë³´ì„¸ìš”.`
      }
    ]
  });
}


if (userMessage.includes('ì±…ìž¥')) {
  return res.json({
    message: [
      {
        type: 'steve',
        text: 'ì±…ì´ ì—„ì²­ ë§Žë„¤ìš”... ì¤‘ê°„ì— êµ¬ë©ë„ ëš«ë ¤ìžˆì–´ìš”. ì´ ë°‘ì— ìžˆëŠ” ì±…ì„ ê½‚ì•„ë„£ì–´ì•¼ ë˜ëŠ” ê±¸ê¹Œìš”? ì´ˆë¡ìƒ‰, ë¹¨ê°„ìƒ‰, ë…¸ëž€ìƒ‰, í°ìƒ‰, íŒŒëž€ìƒ‰ ìƒ‰ê¹”ì´ ëª¨ë‘ ë‹¬ë¼ìš”! ì±…ì„ ê½‚ì•„ë³¼ê¹Œìš”?'
      }
    ]
  });
}

if (userMessage.includes('ì±…') && userMessage.includes('ê½‚')) {
  const pattern = /(í°|ë…¸ëž€|ì´ˆë¡|ë¹¨ê°„|íŒŒëž€)/g;
  const match = userMessage.match(pattern);

  if (match && match.length === 5) {
    const userOrder = match;
    const correctOrder = ['ë¹¨ê°„', 'ë…¸ëž€', 'í°', 'íŒŒëž€', 'ì´ˆë¡'];

    if (JSON.stringify(userOrder) === JSON.stringify(correctOrder)) {
      return res.json({
        message: [
          {
            type: 'narration',
            text: 'ì±…ìž¥ì„ ì˜¬ë°”ë¥¸ ìˆœì„œë¡œ ê½‚ì•˜ìŠµë‹ˆë‹¤. ì±…ìž¥ì´ "ì² ì»¥" ì†Œë¦¬ë¥¼ ë‚´ë©° ì˜†ìœ¼ë¡œ ë¯¸ë„ëŸ¬ì§‘ë‹ˆë‹¤... ë°ì€ ë¹›ì´ ë“¤ì–´ì˜µë‹ˆë‹¤.'
          },
          {
            type: 'steve',
            text: 'ì±…ìž¥ì´... ë¬¸ì´ì˜€ë„¤ìš”...! ì €ê¸° ë­ê°€ ë³´ì´ëŠ” ê²ƒ ê°™ì€ë°ìš”?'
          }
        ],
        image: 'images/hap.png'
      });
    } else {
      return res.json({
        message: [
          {
            type: 'steve',
            text: 'ìŒ... ìˆœì„œê°€ í‹€ë¦° ê²ƒ ê°™ì•„ìš”. ë‹¤ì‹œ ê½‚ì•„ë³¼ê¹Œìš”?'
          }
        ],
        image: 'images/sad.png'
      });
    }
  } else {
    return res.json({
      message: [
        {
          type: 'steve',
          text: 'ì±…ì€ ì´ ë‹¤ì„¯ ê¶Œì´ì—ìš”. í°ìƒ‰, ë…¸ëž€ìƒ‰, ì´ˆë¡ìƒ‰, ë¹¨ê°„ìƒ‰, íŒŒëž€ìƒ‰ ì±…ì´ ìžˆì–´ìš”. ëª¨ë‘ ë‹¤ ê½‚ì•„ì•¼ í•´ìš”!'
        }
      ],
        image: 'images/sad.png'
    });
  }
}

  try {
    const chatCompletion = await openai.chat.completions.create({
      model: 'gpt-3.5-turbo',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userMessage },
      ],
    });

    const reply = chatCompletion.choices[0].message.content.trim();
    res.json({ message: reply });
  } catch (error) {
    console.error('OpenAI API ì—ëŸ¬:', error);
    res.status(500).json({message: 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' });
  }
});

const PORT = 3002;

const start = () => {
  app.listen(PORT, () => {
    console.log(`âœ… Chapter 2 ì„œë²„ ì‹¤í–‰ ì¤‘: http://localhost:${PORT}`);
  });
};

export { start };